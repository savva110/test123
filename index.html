<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Telegram WebApp ‚Äî –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏</title>
    <style>
        :root{
            --bg: var(--tg-theme-bg-color, #ffffff);
            --text: var(--tg-theme-text-color, #0b1220);
            --muted: #6b7280;
            --card: var(--tg-theme-secondary-bg-color, #f3f4f6);
            --btn: var(--tg-theme-button-color, #2481cc);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
        }
        body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--text);padding:18px}
        .container{max-width:720px;margin:0 auto}
        h1{font-size:20px;margin:0 0 12px}
        .card{background:var(--card);padding:14px;border-radius:12px;margin-bottom:12px}
        .user-card{margin-bottom:12px}
        label{font-weight:600;font-size:13px;margin-bottom:6px;display:block}
        textarea{width:100%;min-height:96px;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);resize:vertical;font-size:15px}
        .controls{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
        button{background:var(--btn);color:var(--btn-text);border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
        .secondary{background:transparent;border:1px solid rgba(0,0,0,0.08);color:var(--text)}
        .features{margin-top:10px;font-size:13px;color:var(--muted)}
        .status{margin-top:12px;padding:10px;border-radius:8px;font-weight:600}
        .status.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
        .status.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
        .status.loading{background:#fff3cd;color:#856404;border:1px solid #ffeeba}
    </style>
</head>
<body>
<div class="container">
    <h1>ü§ñ WebApp ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏—è</h1>

    <div id="app" class="card">
        <div id="user-info" class="user-card"></div>

        <label for="messageText">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
        <textarea id="messageText" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å..."></textarea>

        <div class="controls">
            <button id="sendBtn">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button id="sendTimeBtn" class="secondary">üïí –í—Ä–µ–º—è</button>
            <button id="sendRandBtn" class="secondary">üé≤ –°–ª—É—á–∞–π–Ω–æ–µ</button>
        </div>

        <div class="features">
            –¢–µ–∫—É—â–∏–π URL: <code id="current-url"></code>
        </div>

        <div id="status" class="status"></div>
    </div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    const tg = window.Telegram?.WebApp;
    const statusEl = document.getElementById('status');
    const currentUrlEl = document.getElementById('current-url');

    function showStatus(text, type='success', auto=true){
        statusEl.textContent = text;
        statusEl.className = 'status ' + (type || '');
        if(auto && type !== 'loading'){
            setTimeout(()=>{ statusEl.textContent=''; statusEl.className='status'; }, 3000);
        }
    }

    function initApp(){
        currentUrlEl.textContent = window.location.href;

        if(tg?.initDataUnsafe?.user){
            const u = tg.initDataUnsafe.user;
            document.getElementById('user-info').innerHTML = `
                <div><strong>ID:</strong> ${u.id}</div>
                <div><strong>–ò–º—è:</strong> ${u.first_name || ''} ${u.last_name || ''}</div>
                ${u.username ? `<div><strong>Username:</strong> @${u.username}</div>`:''}
            `;
        }
        try{ tg.expand(); }catch(e){}
    }

    function sendMessage(){
        const text = document.getElementById('messageText').value.trim();
        if(!text){ showStatus('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç', 'error'); return; }
        const payload = { action:'send_message', text, timestamp:new Date().toISOString() };

        showStatus('–û—Ç–ø—Ä–∞–≤–∫–∞...', 'loading', false);

        if(typeof tg?.postEvent === 'function'){
            tg.postEvent('web_app_data', JSON.stringify(payload));
            showStatus('‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (postEvent, –±–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏—è)', 'success');
        } else if(typeof tg?.sendData === 'function'){
            tg.sendData(JSON.stringify(payload));
            showStatus('‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (sendData, –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å)', 'success', false);
        } else {
            showStatus('–ú–µ—Ç–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
        }
        document.getElementById('messageText').value='';
    }

    function sendTime(){
        document.getElementById('messageText').value = "üïí –í—Ä–µ–º—è: " + new Date().toLocaleString();
        sendMessage();
    }

    function sendRand(){
        document.getElementById('messageText').value = "üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ: " + (Math.floor(Math.random()*100)+1);
        sendMessage();
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('sendTimeBtn').onclick = sendTime;
    document.getElementById('sendRandBtn').onclick = sendRand;

    window.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
