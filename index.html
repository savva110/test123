<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App</title>
    <style>
        body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--tg-theme-bg-color, #ffffff);
    color: var(--tg-theme-text-color, #000000);
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 600px;
    margin: 0 auto;
}

textarea {
    width: 100%;
    height: 100px;
    padding: 12px;
    border: 1px solid var(--tg-theme-hint-color, #999);
    border-radius: 10px;
    margin-bottom: 15px;
    resize: vertical;
}

button {
    background: var(--tg-theme-button-color, #2481cc);
    color: var(--tg-theme-button-text-color, #ffffff);
    border: none;
    padding: 15px 25px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    width: 100%;
}

.status {
    margin-top: 15px;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}

.status.success {
    background: #d4edda;
    color: #155724;
}

.status.error {
    background: #f8d7da;
    color: #721c24;
}

.status.loading {
    background: #d1ecf1;
    color: #0c5460;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Telegram Web App</h1>
        <p>–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Telegram Mini Apps</p>
        
        <div id="login-section">
            <p>–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –æ—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞</p>
        </div>

        <div id="app-section" style="display: none;">
            <textarea id="messageText" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
            <button onclick="sendMessage()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
            <div id="status"></div>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>let tg = window.Telegram.WebApp;
let user = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
        user = tg.initDataUnsafe.user;
        showApp();
        setupBot();
    } else {
        showLogin();
    }
}

function showApp() {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('app-section').style.display = 'block';
    
    document.querySelector('h1').textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}!`;
}

function showLogin() {
    document.getElementById('login-section').innerHTML = `
        <p>üîí –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞</p>
        <p>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID –≤—Ä—É—á–Ω—É—é:</p>
        <input type="text" id="manualUserId" placeholder="–í–∞—à Telegram ID">
        <button onclick="useManualId()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    `;
}

function useManualId() {
    const manualId = document.getElementById('manualUserId').value;
    if (manualId) {
        user = { id: manualId };
        showApp();
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ Telegram Web App
function setupBot() {
    tg.MainButton.setText("–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ");
    tg.MainButton.show();
    tg.MainButton.onClick(sendMessage);
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
async function sendMessage() {
    const messageText = document.getElementById('messageText').value.trim();
    
    if (!messageText) {
        showStatus('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
        return;
    }

    showStatus('–û—Ç–ø—Ä–∞–≤–∫–∞...', 'loading');

    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram Web App –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        tg.sendData(JSON.stringify({
            type: 'message',
            text: messageText,
            userId: user.id
        }));
        
        showStatus('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!', 'success');
        document.getElementById('messageText').value = '';
        
    } catch (error) {
        showStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');
        console.error('Error:', error);
    }
}

function showStatus(message, type) {
    const status = document.getElementById('status');
    status.textContent = message;
    status.className = `status ${type}`;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('DOMContentLoaded', init);</script>
</body>
</html>