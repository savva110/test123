<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Web App1</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }
    .container { max-width: 600px; margin: 0 auto; }
    textarea {
      width: 100%; height: 100px; padding: 15px;
      border: 2px solid var(--tg-theme-hint-color, #cccccc);
      border-radius: 12px; margin-bottom: 15px;
      font-family: inherit; font-size: 16px;
    }
    button {
      background: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      border: none; padding: 15px 20px;
      border-radius: 12px; cursor: pointer;
      font-size: 16px; font-weight: 500;
      margin: 5px 0; width: 100%;
    }
    .features { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
    .status { margin-top: 20px; padding: 15px; border-radius: 10px; text-align: center; font-weight: 500; }
    .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .status.loading { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
  </style>
</head>
<body>
  <div class="container">
    <div id="app">
      <h1>ü§ñ –ú–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
      <div id="user-info"></div>
      <textarea id="messageText" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
      <button onclick="sendMessage()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ–±–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
      <div class="features">
        <button onclick="sendTime()">üïí –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Ä–µ–º—è</button>
        <button onclick="sendRandom()">üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ</button>
      </div>
      <div id="status"></div>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    let tg = window.Telegram?.WebApp;
    let userData = tg?.initDataUnsafe?.user || { id: 0, first_name: "–ì–æ—Å—Ç—å" };

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É
    window.addEventListener('DOMContentLoaded', () => {
      displayUserInfo();
      setupTelegramFeatures();
    });

    function displayUserInfo() {
      const div = document.getElementById('user-info');
      div.innerHTML = `
        <div class="user-card">
          <h3>üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h3>
          <p><strong>ID:</strong> <code>${userData.id}</code></p>
          <p><strong>–ò–º—è:</strong> ${userData.first_name} ${userData.last_name || ''}</p>
        </div>`;
    }

    function setupTelegramFeatures() {
      if (tg) {
        tg.MainButton.setText("–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ");
        tg.MainButton.show();
        tg.MainButton.onClick(sendMessage);
        tg.expand();
      }
    }

    function showStatus(message, type) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status ${type}`;
    }

    function sendMessage() {
      const text = document.getElementById('messageText').value.trim();
      if (!text) { showStatus("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è", "error"); return; }
      showStatus("–û—Ç–ø—Ä–∞–≤–∫–∞...", "loading");

      if (tg) {
        tg.sendData(JSON.stringify({ action: "send_message", text, user_id: userData.id }));
        showStatus("‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!", "success");
      } else {
        showStatus("‚ÑπÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ: " + text, "success");
      }
      document.getElementById('messageText').value = '';
    }

    function sendTime() {
      const time = new Date().toLocaleString('ru-RU');
      document.getElementById('messageText').value = "üïí –í—Ä–µ–º—è: " + time;
      sendMessage();
    }

    function sendRandom() {
      const n = Math.floor(Math.random() * 100) + 1;
      document.getElementById('messageText').value = "üé≤ –ß–∏—Å–ª–æ: " + n;
      sendMessage();
    }
  </script>
</body>
</html>
