<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—Ä–æ–∫–∏ ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞—Å—Å–∞</title>
    <style>
        :root { --max-w: 384px; --max-h: 590px; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin:0; padding:10px; background: var(--tg-theme-bg-color,#fff); color: var(--tg-theme-text-color,#000); box-sizing: border-box; max-width: var(--max-w); height: var(--max-h); overflow: hidden; margin-left:auto; margin-right:auto; }
        h1 { margin: 0 0 8px; font-size: 18px; }
        .content { display:flex; flex-direction:column; height: calc(var(--max-h) - 20px); }
        .main { flex:1; overflow:auto; }
        .footer { padding-top: 8px; }
        .section { background: var(--tg-theme-secondary-bg-color,#f5f5f5); border-radius: 10px; padding: 10px; border-left: 4px solid var(--tg-theme-button-color,#2481cc); margin-bottom: 8px; }
        .row { display:flex; gap:6px; align-items:center; }
        .row input[type="text"] { flex: 1; padding: 8px; border: 2px solid var(--tg-theme-hint-color,#ccc); border-radius: 8px; font-size: 13px; }
        .row input[type="color"] { width: 36px; height: 32px; border: none; background: transparent; padding:0; }
        .row label { display:flex; align-items:center; gap:6px; font-size: 13px; white-space:nowrap; }
        .buttons { display:flex; gap:8px; margin-top: 8px; }
        .buttons a, .buttons button, #save-all { display:block; text-decoration:none; text-align:center; background: var(--tg-theme-button-color,#2481cc); color: var(--tg-theme-button-text-color,#fff); padding: 10px 12px; border-radius: 10px; border:none; font-size:14px; width:100%; }
        .ghost { background: transparent; color: var(--tg-theme-button-color,#2481cc); border: 1px solid var(--tg-theme-button-color,#2481cc); }
        .item { background: #ffffff10; border-radius: 8px; padding: 8px; display:flex; align-items:center; gap:6px; margin-top:6px; }
        .rm { flex: 0 0 auto; }
        .color { width: 12px; height: 12px; border-radius:50%; border:1px solid #0001; }
        .hint { font-size: 12px; opacity:.7; margin:6px 0 0; }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="content">
        <div class="main">
            <h1>üìö –£—Ä–æ–∫–∏</h1>
            <div class="section" id="add-section">
                <h3>‚ûï –£—Ä–æ–∫–∏</h3>
                <div id="add-list"></div>
                <div class="buttons"><button id="add-row" class="ghost">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ</button></div>
                <p class="hint">–£–¥–∞–ª–µ–Ω–∏–µ ‚Äî –∫–Ω–æ–ø–∫–æ–π ¬´–£–¥–∞–ª–∏—Ç—å¬ª —Å–ø—Ä–∞–≤–∞ –æ—Ç —Å—Ç—Ä–æ–∫–∏.</p>
            </div>
            <div class="section" id="schedule-section">
                <h3>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                <p class="hint">–®–∞–±–ª–æ–Ω. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–π –∂–µ –∫–Ω–æ–ø–∫–æ–π.</p>
            </div>
        </div>
        <div class="footer">
            <button id="save-all">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    <script>
        const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
        const urlParams = new URLSearchParams(location.search);
        function getLessons() { try { return JSON.parse(urlParams.get('lessons')||'[]'); } catch { return []; } }
        let lessons = getLessons();

        const addList = document.getElementById('add-list');

        function createAddRow(name='', color='#2481cc', hasSub=false){
            const wrap = document.createElement('div'); wrap.className='item';
            wrap.innerHTML = `
                <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞" value="${String(name).replaceAll('"','&quot;')}">
                <input type="color" value="${/^#([0-9a-fA-F]{6})$/.test(String(color))?color:'#2481cc'}">
                <label><input type="checkbox" ${hasSub?'checked':''}> –ü–æ–¥–≥—Ä—É–ø–ø—ã</label>
                <button class="ghost rm">‚úñ –£–¥–∞–ª–∏—Ç—å</button>
            `;
            wrap.querySelector('.rm').onclick = () => wrap.remove();
            return wrap;
        }
        function renderAdd(){
            addList.innerHTML='';
            if (lessons.length){ lessons.forEach(([n,c,s])=> addList.appendChild(createAddRow(n,c,!!s))); }
            else { addList.appendChild(createAddRow()); }
        }
        function collectAdd(){
            const rows = addList.querySelectorAll('.item'); const res=[];
            rows.forEach(r=>{ const n=r.querySelector('input[type="text"]').value.trim(); const c=r.querySelector('input[type="color"]').value; const s=r.querySelector('input[type="checkbox"]').checked; if(n) res.push([n,c,s]); });
            return res;
        }

        document.getElementById('add-row').onclick=()=> addList.appendChild(createAddRow());
        document.getElementById('save-all').onclick=()=>{
            const lessonsToSave = collectAdd();
            // –í –±—É–¥—É—â–µ–º —Å—é–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å scheduleData
            tg.sendData(JSON.stringify({ action:'add_lessons', lessons: lessonsToSave }));
        };
        // —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –º–µ—Å—Ç–µ (–∫–Ω–æ–ø–∫–æ–π —É —ç–ª–µ–º–µ–Ω—Ç–∞). –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ add-submit

        renderAdd();
    </script>
</body>
</html>


